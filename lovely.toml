[manifest]
version = "1.0.0"
dump_lua = true
priority = 0

# Run start
[[patches]]
[patches.pattern]
target = "game.lua"
pattern = '''self.GAME = saveTable and saveTable.GAME or self:init_game_object()'''
position = "after"
payload = '''
TW_BL:start_run()
'''
match_indent = true
overwrite = false

[[patches]]
[patches.pattern]
target = "card.lua"
pattern = '''function Card:click()'''
position = "after"
payload = '''
if self.ability and self.ability.twbl_state_prevent_action then return end
'''
match_indent = true
overwrite = false

[[patches]]
[patches.pattern]
target = "functions/button_callbacks.lua"
pattern = 'G.FUNCS.skip_booster = function(e)'
position = "after"
payload = """
if TW_BL.G.state_sticker_chat_booster_use and TW_BL.EVENTS.request_delay(5, function() G.FUNCS.skip_booster(e) end) then
    return
end
"""
match_indent = true

[[patches]]
[patches.pattern]
target = "functions/button_callbacks.lua"
pattern = 'G.FUNCS.end_consumeable = function(e, delayfac)'
position = "after"
payload = """
if TW_BL.G.state_sticker_chat_booster_use and TW_BL.EVENTS.request_delay(5, function() G.FUNCS.end_consumeable(e, delayfac) end) then
    return
end
"""
match_indent = true

# WIP
# [[patches]]
# [patches.pattern]
# target = "game.lua"
# pattern = 'G.load_shop_booster = nil'
# position = "after"
# payload = """
# elseif TW_BL.G.cursed_boosters then 
#     twitch_cursed_boosters_setup_shop()
# """
# match_indent = true
